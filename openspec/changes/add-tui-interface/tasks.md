# 实现任务清单

## 阶段 1: 基础框架搭建

- [ ] 创建 `tui.rs` 模块基础结构
  - 定义 `AppState` 枚举（主菜单、仪表板、更新进度、练习等）
  - 定义 `App` 结构体，包含状态管理和数据
  - 添加 `main()` 函数的 TUI 分支

- [ ] 实现终端初始化和清理
  - 使用 `crossterm` 设置备用模式、鼠标捕获
  - 实现终端状态恢复（panic 时也要恢复）
  - 添加最小尺寸检测（80x24）

- [ ] 实现基础事件循环
  - 使用 `crossterm::event()` 监听键盘事件
  - 映射 KeyCode 到 Action（Up, Down, Enter, Esc, q）
  - 实现 `App::handle_action()` 方法

- [ ] 创建 ratatui 布局系统
  - 定义 `Layout` 块结构（Header, Main, Footer）
  - 实现基础渲染函数 `draw_app()`

## 阶段 2: 主菜单实现

- [ ] 实现主菜单界面
  - 创建 `MainMenu` 组件
  - 显示功能选项列表（仪表板、进度、练习等）
  - 实现方向键选择和高亮效果

- [ ] 添加菜单导航
  - ↑↓ 键移动选择
  - Enter 键进入对应界面
  - q 键退出程序

- [ ] 实现状态切换
  - `AppState::MainMenu` → 各子状态
  - 子状态 → 返回 MainMenu

## 阶段 3: 仪表板界面

- [ ] 实现仪表板视图
  - 创建 `DashboardView` 组件
  - 显示总体进度百分比
  - 绘制进度条（使用 `BarChart` 或自定义 Block）

- [ ] 显示模块列表
  - 从 `LearningRepo` 获取模块数据
  - 显示每个模块的：
    - 完成状态图标（✅/🟡/⬜）
    - 模块名称
    - 任务完成情况

- [ ] 显示统计数据
  - 连续学习天数（从数据库获取）
  - 总完成进度

- [ ] 实现 Esc 返回主菜单

## 阶段 4: 进度更新界面

- [ ] 创建模块选择器
  - 列出所有学习模块
  - 方向键选择
  - 高亮当前选中项

- [ ] 创建任务复选框组
  - 显示 5 个任务（概念、示例、练习、综合、自检）
  - 空格键切换选中状态
  - 显示当前完成状态（从数据库读取）

- [ ] 实现 Tab 导航
  - 在模块选择器和任务复选框之间切换焦点
  - 视觉区分焦点区域

- [ ] 实现保存功能
  - Enter 确认后调用 `progress::update_task_status()`
  - 显示成功消息或错误弹窗
  - 返回主菜单

- [ ] 实现 Esc 取消/返回

## 阶段 5: 练习界面

- [ ] 创建练习配置视图
  - 模块选择器
  - 题目数量输入/选择

- [ ] 实现题目视图
  - 显示题目编号和进度（如 "题目 3/5"）
  - 显示题目内容
  - 显示选项列表

- [ ] 实现选项选择
  - 方向键在选项间移动
  - 高亮当前选项
  - Enter 确认答案

- [ ] 实现答案反馈
  - 显示正确/错误
  - 显示解析说明
  - 按任意键继续下一题

- [ ] 显示测试结果
  - 所有题目完成后显示：
    - 得分和正确率
    - 错题知识点
    - 鼓励消息

- [ ] 集成数据库记录
  - 调用 `exercise::run_practice()` 或其逻辑
  - 使用 `db::record_practice_result()` 保存结果

## 阶段 6: 其他界面

- [ ] 实现成就界面
  - 显示已解锁成就列表
  - 显示待解锁成就
  - 从数据库获取成就数据

- [ ] 实现提醒设置界面
  - 小时输入（0-23）
  - 分钟输入（0-59）
  - 调用 `notify::set_reminder()`

- [ ] 实现数据导出界面
  - 显示导出进度
  - 调用 `storage::export_data()`
  - 显示成功/失败消息

## 阶段 7: 完善和优化

- [ ] 添加帮助信息
  - 底部提示栏显示当前可用按键
  - 根据不同界面动态更新提示

- [ ] 错误处理
  - 实现错误弹窗组件
  - 捕获数据库错误、IO 错误等
  - 友好错误消息

- [ ] 视觉优化
  - 统一颜色主题
  - 添加边框和分隔线
  - 优化布局间距

- [ ] 响应式处理
  - 监听终端尺寸变化
  - 动态调整布局

- [ ] 性能优化
  - 只在状态变化时重绘
  - 避免不必要的数据库查询

## 阶段 8: CLI 兼容性

- [ ] 修改 main.rs 支持双模式
  - 添加 `--tui` / `--interactive` 标志
  - 保留原有子命令（dashboard, update 等）
  - 无参数时默认 TUI（或询问）

- [ ] 确保 CLI 模式不变
  - 测试所有原有 CLI 命令
  - 验证输出格式一致

## 阶段 9: 测试和文档

- [ ] 手动测试所有功能
  - 每个界面的导航
  - 边界情况（空数据、错误输入）
  - 跨平台测试（Windows/Linux/macOS）

- [ ] 更新 README.md
  - 添加 TUI 使用说明
  - 更新命令示例
  - 添加按键操作指南

- [ ] 清理代码
  - 移除未使用的导入
  - 统一代码风格
  - 添加必要注释

## 验收标准

完成以下检查即认为任务完成：

1. 所有界面可以通过纯键盘操作访问
2. 导航流畅，无明显延迟
3. CLI 模式完全保留并正常工作
4. 在 Windows 上正常运行
5. 错误情况下程序不崩溃
6. README 更新完整
