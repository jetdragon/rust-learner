# 修复 TUI 导航双步移动问题

## 问题描述

TUI 界面存在严重的导航问题：
- 使用方向键（↑↓）选择选项时，光标会移动两行而不是一行
- 使用 Tab 键在不同栏目间切换焦点时，会切换两次而不是一次

## 问题分析

经过代码审查，发现以下可能导致问题的因素：

1. **事件处理循环问题** - 可能存在重复的事件监听或事件冒泡
2. **状态更新逻辑** - 导航状态可能被更新两次
3. **渲染刷新机制** - 可能导致状态回退或重复渲染
4. **键盘事件重复注册** - 可能存在多个事件监听器

## 解决方案

### 1. 事件处理优化
- 确保每个键盘事件只处理一次
- 添加事件防抖机制
- 检查是否有重复的事件监听器

### 2. 状态管理改进
- 添加状态变更验证，防止重复更新
- 实现状态变更日志，便于调试
- 确保状态更新后立即生效

### 3. 渲染机制优化
- 检查渲染循环是否导致状态回退
- 确保 UI 状态与数据状态同步
- 优化刷新频率，避免不必要的重绘

## 实施计划

1. **问题诊断** - 添加调试日志，确定事件处理流程
2. **代码重构** - 优化事件处理和状态管理
3. **测试验证** - 确保所有导航操作响应正确
4. **性能优化** - 确保修复不影响整体性能

## 预期效果

- 方向键每次只移动一行
- Tab 键每次只切换一次焦点
- 所有导航操作响应准确且一致
- 保持现有的用户体验和性能