# 综合练习：文本分析工具

## 项目描述

创建一个文本分析工具，能够统计文本的各种信息，包括词频、行数、字符数等。

## 项目结构

```
综合练习/
├── src/
│   ├── lib.rs          # 主库文件
│   ├── analyzer.rs     # 文本分析器
│   └── stats.rs        # 统计模块
└── tests/
    └── integration.rs  # 集成测试
```

## 需求

### 1. 词频统计

```rust
use std::collections::HashMap;

pub fn word_frequency(text: &str) -> HashMap<String, usize> {
    let mut freq = HashMap::new();

    // 按空白分割文本
    // 转小写
    // 移除标点
    // 统计每个词出现的次数

    freq
}

#[test]
fn test_word_frequency() {
    let text = "hello world hello";
    let freq = word_frequency(text);
    assert_eq!(freq.get("hello"), Some(&2));
    assert_eq!(freq.get("world"), Some(&1));
}
```

### 2. 行统计

```rust
pub struct LineStats {
    pub line_count: usize,
    pub empty_lines: usize,
    pub longest_line: usize,
    pub shortest_line: usize,
}

pub fn analyze_lines(text: &str) -> LineStats {
    // 统计总行数
    // 统计空行数
    // 找出最长和最短的行
    todo!()
}
```

### 3. 字符统计

```rust
pub struct CharStats {
    pub char_count: usize,
    pub letter_count: usize,
    pub digit_count: usize,
    pub space_count: usize,
    pub char_frequency: HashMap<char, usize>,
}

pub fn analyze_chars(text: &str) -> CharStats {
    // 统计各种字符类型
    // 统计每个字符出现的频率
    todo!()
}
```

### 4. 最常用的词

```rust
pub fn most_common_words(text: &str, n: usize) -> Vec<(String, usize)> {
    // 返回出现频率最高的 n 个词
    // 按频率降序排列
    todo!()
}

#[test]
fn test_most_common_words() {
    let text = "the quick brown fox jumps over the lazy dog the";
    let top = most_common_words(text, 2);
    assert_eq!(top[0].0, "the");
    assert_eq!(top[0].1, 3);
}
```

### 5. 文本摘要

```rust
pub struct TextSummary {
    pub word_count: usize,
    pub unique_words: usize,
    pub avg_word_length: f64,
    pub longest_word: String,
}

pub fn summarize(text: &str) -> TextSummary {
    // 计算各种统计信息
    todo!()
}
```

### 6. 搜索和替换

```rust
pub fn find_all(text: &str, pattern: &str) -> Vec<usize> {
    // 返回所有匹配的位置
    todo!()
}

pub fn replace_all(text: &str, from: &str, to: &str) -> String {
    // 替换所有匹配项
    todo!()
}
```

### 7. 文本分段

```rust
pub fn split_into_paragraphs(text: &str) -> Vec<String> {
    // 按空行分段
    // 过滤空段落
    todo!()
}

pub fn split_into_sentences(text: &str) -> Vec<String> {
    // 按 . ! ? 分句
    // 过滤空句子
    todo!()
}
```

### 8. 高级统计

```rust
pub struct AdvancedStats {
    pub vocabulary_richness: f64,  // 独特词 / 总词数
    pub avg_sentence_length: f64,
    pub most_common_length: usize,
}

pub fn advanced_analysis(text: &str) -> AdvancedStats {
    // 计算更复杂的统计信息
    todo!()
}
```

## 实用功能

### 1. 文本清洗

```rust
pub fn clean_text(text: &str) -> String {
    // 移除多余空格
    // 统一引号
    // 移除控制字符
    todo!()
}
```

### 2. 关键词提取

```rust
pub fn extract_keywords(text: &str, n: usize) -> Vec<String> {
    // 使用 TF-IDF 类似算法
    // 返回最重要的 n 个关键词
    todo!()
}
```

### 3. 文本比较

```rust
pub fn similarity(text1: &str, text2: &str) -> f64 {
    // 计算两个文本的相似度 (0-1)
    // 可以基于词频统计
    todo!()
}
```

## 测试要求

```rust
#[cfg(test)]
mod tests {
    use super::*;

    const SAMPLE_TEXT: &str = r#"
        The quick brown fox jumps over the lazy dog.
        The dog was not amused.
        The fox laughed and ran away.
    "#;

    #[test]
    fn test_word_frequency() {
        let freq = word_frequency(SAMPLE_TEXT);
        assert_eq!(freq.get("the"), Some(&4));
    }

    #[test]
    fn test_line_stats() {
        let stats = analyze_lines(SAMPLE_TEXT);
        assert_eq!(stats.line_count, 3);
    }

    #[test]
    fn test_char_stats() {
        let stats = analyze_chars(SAMPLE_TEXT);
        assert!(stats.char_count > 0);
    }

    #[test]
    fn test_most_common() {
        let words = most_common_words(SAMPLE_TEXT, 3);
        assert_eq!(words[0].0, "the");
    }
}
```

## 性能考虑

1. **使用合适的数据结构**
   - HashMap 用于词频统计
   - HashSet 用于去重
   - Vec 用于有序数据

2. **避免不必要的复制**
   - 使用 &str 而不是 String
   - 使用迭代器而不是中间 Vec

3. **预分配容量**
   - `HashMap::with_capacity()`
   - `Vec::with_capacity()`

## 挑战任务

1. **支持多种语言分词**
2. **实现 n-gram 分析**
3. **情感分析**
4. **文本聚类**

## 学习要点

通过这个综合练习，你将掌握：

- Vec 的各种操作
- HashMap 的实际应用
- 迭代器的使用
- 字符串处理技巧
- 算法实现

## 完成标准

- [ ] 所有单元测试通过
- [ ] 所有集成测试通过
- [ ] 代码通过 clippy 检查
- [ ] 使用适当的集合类型
- [ ] 代码格式化符合 rustfmt 标准
